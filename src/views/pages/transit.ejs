<%- include ('../partials/head') %>
  <%- include ('../partials/menu') %>
    <head>
      <link rel="stylesheet" href="styles/style.css">
      <script src="modal/modal.js"></script>
    </head>
    <div class="col"><%- include ('../partials/message') %></div>
    <main style="padding: 30px; padding-top: 20px;">
      <div class="container">
        <form style="padding-top: 20px;">
          <div class="card">
            <div class="card-body">
              <h4>Get Trip Suggestions</h4>
              <div class="row">
                <div class="col-md-6">
                  <form action="/displayMap" method="POST">
                    <div class="form-group">
                      <label for="textInput">To Your Destination</label>
                      <input type="text" id="destination" name="destination" class="form-control"
                        placeholder="Type Your Destination">
                    </div>
                    <div class="form-group">
                      <label for="disabledSelect">From My Location</label>
                      <input type="text" id="source" name="source" class="form-control"
                        placeholder="Type Your Location">
                    </div>
                    <div style="padding-top: 10px;">
                      <button type="submit" class="btn btn-outline-dark" style="float: right;">Search</button>
                    </div>
                    </fieldset>
                  </form>

                  <div style="padding-top: 40px;" >
                    <div class="card w-80">
                      <div class="card-body">
                          <h5 class="card-title" style="display:inline">My Trips</h5>
                      </div>
                          <ul class="list-group list-group-flush">
                              <!--  -->
                              <% if(data && data != []) {
                                  data.forEach(function(item) {%>
                                      <li class="list-group-item">
                                          <div class="row">
                                              <div class="col-md-6">
                                                  <p> <b>Date:</b> <%- item.time %></p>
                                                  <p> <b>From:</b> <%- item.departing %></p>
                                                  <p> <b>To:</b> <%- item.destination %></p>
                                                  <p> <b>Purpose:</b> <%- item.purpose %></p>
                                              </div>
                                              <div class="col">    
                                                  <b>Seats:</b> 
                                                  <p><%- item.seats %></p>
                                                  <p>TBC</p>
                                              </div>
                                              <div class="col">
                                                <button type="button" onclick="showModal('info','<p>info</p>','<button>bye</button>')" class="btn btn-outline-dark" style="float: right;">Info</button>
                                                <form action="/trip/joinTrip" method="POST">
                                                  <input type="hidden" id="tripID" name="tripID" value="<%- item.trip_id %>">
                                                  <button type="submit" class="btn btn-outline-dark" style="float: right;">Join</button>
                                              </form>
                                              </div>
                                          </div>
                                          </li>
                                   <%})
                              } else {
                                console.log("No trips in database! Please add a trip." + data);
                                %>
                                <p>No trips in database! Please add a trip.</p>
                                <% } %>
                          </div> 
                      </div>
                </div>
                <div class="col">
                  <div id="map"></div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <script>
        var map_init = L.map('map', {
          center: [39.7392, -104.9903],
          zoom: 10
        });
        var map = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map_init);

        // use this line to add markers depending on users input
        // var marker = L.marker([North Co, West Co]).addTo(map_init);

        var Basemaps = {
          "MAP": map
        }
        var Overlaymaps = {
          "Marker": marker
        }
        L.control.layers(Basemaps, Overlaymaps).addTo(map_init);


      </script>

      <script type="text/javascript"
        src="<%- refUrl %>"></script>

      <script>

        google.maps.event.addDomListener(window, 'load', initialize);

        function initialize() {

          var input = document.getElementById('destination');
          var input2 = document.getElementById('source');

          var autocomplete = new google.maps.places.Autocomplete(input);
          var autocomplete2 = new google.maps.places.Autocomplete(input2);
          autocomplete.addListener('place_changed', function () {

            var place = autocomplete.getPlace();

            // place variable will have all the information you are looking for.

            $('#lat').val(place.geometry['location'].lat());

            $('#long').val(place.geometry['location'].lng());

            autocomplete2.addListener('source_changed'), function () {

              var place2 = autocomplete.getPlace();

              // place variable will have all the information you are looking for.

              $('#lat').val(place2.geometry['location'].lat());

              $('#long').val(place2.geometry['location'].lng());
            }

          });

        }





      </script>
    </main>




    <%- include ('../partials/footer') %>