<%- include ('../partials/head') %>
  <%- include ('../partials/menu') %>
    <head>
      <link rel="stylesheet" href="styles/style.css">
      <script src="modal/modal.js"></script>
      <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=<%=apikey%>&libraries=places"></script>
      <script src="/maps/map.js"></script>
    </head>
    <div class="col"><%- include ('../partials/message') %></div>
    <main style="padding: 30px; padding-top: 20px;">
      <div class="container">
        <form style="padding-top: 20px;">
          <div class="card">
            <div class="card-body">
              <h4>Get Trip Suggestions</h4>
              <div class="row">
                <div class="col-md-6">
                  <form action="/displayMap" method="POST">
                    <div class="form-group">
                      <label for="fromYourLocation" class="col-xs-2 control label"><i class="fa-regular fa-circle-dot"></i>From Your Location</label>
                      <input type="text" id="fromYourLocation" name="fromYourLocation" class="form-control"
                        placeholder="Type Your Location">
                      <label for="destination" class="col-xs-2 control label"><i class="fa-solid fa-location-dot"></i>To Your Destination</label>
                      <input type="text" id="destination" name="destination" class="form-control"
                        placeholder="Type Your Destination">
                    </div>
                    <div style="padding-top: 10px;">
                      <button type="submit" class="btn btn-outline-dark" style="float: right;">Search</button>
                    </div>
                    </fieldset>
                  </form>

                  <div style="padding-top: 40px;" >
                    <div class="card w-80">
                      <div class="card-body">
                          <h5 class="card-title" style="display:inline">My Trips</h5>
                      </div>
                          <ul class="list-group list-group-flush">
                              <!--  -->
                              <% if(data && data != []) {
                                  data.forEach(function(item) {%>
                                      <li class="list-group-item">
                                          <div class="row">
                                              <div class="col-md-6">
                                                  <p> <b>Date:</b> <%- item.time %></p>
                                                  <p> <b>From:</b> <%- item.departing %></p>
                                                  <p> <b>To:</b> <%- item.destination %></p>
                                                  <p> <b>Purpose:</b> <%- item.purpose %></p>
                                              </div>
                                              <div class="col">    
                                                  <b>Seats:</b> 
                                                  <p><%- item.seats %></p>
                                                  <p>TBC</p>
                                              </div>
                                              <div class="col">
                                                <button type="button" onclick="showModal('info','<p>info</p>','<button>bye</button>')" class="btn btn-outline-dark" style="float: right;">Info</button>
                                                <form action="/trip/joinTrip" method="POST">
                                                  <input type="hidden" id="tripID" name="tripID" value="<%- item.trip_id %>">
                                                  <button type="submit" class="btn btn-outline-dark" style="float: right;">Join</button>
                                              </form>
                                              </div>
                                          </div>
                                          </li>
                                   <%})
                              } else {
                                console.log("No trips in database! Please add a trip." + data);
                                %>
                                <p>No trips in database! Please add a trip.</p>
                                <% } %>
                          </div> 
                      </div>
                </div>
                <div class="col">
                  <div id="map"></div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>


<!-- google Map -->

<script>
let googleMap;

async function initMap() {
  //@ts-ignore
  const { Map } = await google.maps.importLibrary("maps");

  googleMap = new Map(document.getElementById("map"), {
    center: { lat: 39.7392, lng: -104.9903 },
    zoom: 10,
  });
}

initMap();


        google.maps.event.addDomListener(window, 'load', initialize);

        function initialize() {

          var input = document.getElementById('destination');
          var input2 = document.getElementById('fromYourLocation');

          var autocomplete = new google.maps.places.Autocomplete(input);
          var autocomplete2 = new google.maps.places.Autocomplete(input2);
          autocomplete.addListener('place_changed', function () {

            var place = autocomplete.getPlace();

            // place variable will have all the information you are looking for.

            $('#lat').val(place.geometry['location'].lat());

            $('#long').val(place.geometry['location'].lng());

            autocomplete2.addListener('source_changed'), function () {

              var place2 = autocomplete.getPlace();

              // place variable will have all the information you are looking for.

              $('#lat').val(place2.geometry['location'].lat());

              $('#long').val(place2.geometry['location'].lng());


              
            }

          });

        }





  </script>
  </main>




    <%- include ('../partials/footer') %>