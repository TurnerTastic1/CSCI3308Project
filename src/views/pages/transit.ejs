<%- include ('../partials/head') %>
  <%- include ('../partials/menu') %>
    <head>
      <link rel="stylesheet" href="styles/style.css">
      <script src="modal/modal.js"></script>
      <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=<%=apikey%>&libraries=places"></script>
    </head>
    <div class="col"><%- include ('../partials/message') %></div>
    <main style="padding: 30px; padding-top: 20px;">
      <div class="container">
        <form style="padding-top: 20px;">
          <div class="card">
            <div class="card-body">
              <h4>Get Trip Suggestions</h4>
              <div class="row">
                <div class="col-md-6">
                  <form action="/displayMap" method="POST">
                    <div class="form-group">
                      <label for="from" class="col-xs-2 control label"><i class="fa-regular fa-circle-dot"></i>From Your Location</label>
                      <input type="text" id="from" name="from" class="form-control"
                        placeholder="Type Your Location">
                      <label for="to" class="col-xs-2 control label"><i class="fa-solid fa-location-dot"></i>To Your to Destination</label>
                      <input type="text" id="to" name="to" class="form-control"
                        placeholder="Type Your Destination">
                    </div>
                    <div style="padding-top: 10px;">
                      <button type="submit" class="btn btn-outline-dark" style="float: right;">Search</button>
                    </div>
                    </fieldset>
                  </form>

                  <div style="padding-top: 40px;" >
                    <div class="card w-80">
                      <div class="card-body">
                          <h5 class="card-title" style="display:inline">My Trips</h5>
                      </div>
                          <ul class="list-group list-group-flush">
                              <!--  -->
                              <% if(data && data != []) {
                                  data.forEach(function(item) {%>
                                      <li class="list-group-item">
                                          <div class="row">
                                              <div class="col-md-6">
                                                  <p> <b>Date:</b> <%- item.time %></p>
                                                  <p> <b>From:</b> <%- item.departing %></p>
                                                  <p> <b>To:</b> <%- item.destination %></p>
                                                  <p> <b>Purpose:</b> <%- item.purpose %></p>
                                              </div>
                                              <div class="col">    
                                                  <b>Seats:</b> 
                                                  <p><%- item.seats %></p>
                                                  <p>TBC</p>
                                              </div>
                                              <div class="col">
                                                <button type="button" onclick="showModal('Trip details','<p><b>Time :</b> <%- item.time %></p> <p><b>From : </b><%- item.departing %></p> <p><b>To :</b> <%- item.destination %></p> <p><b>Purpose : </b><%- item.purpose %></p> <p><b>Seats :</b> <%- item.seats %></p>','<button>bye</button>')" class="btn btn-outline-dark" style="float: right;">Info</button>
                                                <form action="/trip/joinTrip" method="POST">
                                                  <input type="hidden" id="tripID" name="tripID" value="<%- item.trip_id %>">
                                                  <button style="margin-left: 10px;"type="submit" class="btn btn-outline-dark" style="float: right;">Join</button>
                                                </form>
                                              </div>
                                          </div>
                                          </li>
                                   <%})
                              } else {
                                console.log("No trips in database! Please add a trip." + data);
                                %>
                                <p>No trips in database! Please add a trip.</p>
                                <% } %>
                          </div> 
                      </div>
                </div>
                <div class="col">
                  <div id="map"></div>
                  <div id="output"></div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>



<!-- google Map -->

<!-- <script>



        


// set map option

var myLatLng = { lat: 39.7392, lng: -104.9903 };
var mapOptions = {
    center: myLatLng,
    zoom: 10,
    mapTypeId: google.maps.MapTypeId.ROADMAP
};

// create Map

var map = new google.maps.Map(document.getElementById("map"), mapOptions);

// create a Directions service object to use the route method and get a result for our request

var directionsService = new google.maps.DirectionsService();

// create a DirectionRenderer object which we will use to display

var directionsDisplay = new google.maps.DirectionsRenderer();

//bind the directionsRenderer to the map

directionsDisplay.setMap(map);

// function

function calRoute() {

  //create request
  var request = {
      origin: document.getElementById("from").value,
      destination: document.getElementById("to").value,
      travelMode: google.maps.TravelMode.DRIVING, // WALKING, BYCYCLING, TRANSFORTATION
      unitSystem: google.maps.UnitSystem.IMPERIAL
  }

  //Pass the request to the route method
  directionsService.route(request, (result, status) => {
    if (status == google.maps.DirectionsStatus.Ok) {


      //get distance and time
      const output = document.querySelector('#output');
      output.innerHTML = "<div class='alert-info'> From: " + document.getElementById("from").value + ".<br />To: " + document.getElementById("to").value + ". <br /> Driving distance <i class='fa-solid fa-road'></i>: " + result.routes[0].legs[0].distance.text + ". </div>";

      //display routeX
      directionsDisplay.setDirection(result); 
    } else {
      //delete route from map
      directionsDisplay.setDirection({ routes: []});

      //center map in boulder
      map.setCenter(myLatLng);

      //show error message.
      output.innerHTML = "<div class='alert-danger'><i class='fas fa-exclamation-triangle'></i> Could not retrieve driving distance. </div>"

    }
  });
}

// create autocomplete objects for all input

var options = {
  types: ['(cities)']
}

var input1 = document.getElementById("from");
var autocomplete1 = new google.maps.places.Autocomplete(input1, options)

var input2 = document.getElementById("to");
var autocomplete2 = new google.maps.places.Autocomplete(input2, options)



  </script> -->

  <script>
        google.maps.event.addDomListener(window, 'load', initialize);

function initialize() {
  var input = document.getElementById('to');
  var input2 = document.getElementById('from');

  let logPlaces = ac => {
    console.log(ac);
    var plc = ac.getPlace();
    console.log(plc);
    // console.log(place.geometry['location'].lat());
    // console.log(place.geometry['location'].lng());
  }

  var autocomplete = new google.maps.places.SearchBox(input);
  var autocomplete2 = new google.maps.places.SearchBox(input2);
  // autocomplete.addListener("places_changed", () => console.log("Yes 1!"));
  // autocomplete2.addListener("places_changed", () => console.log("Yes 2!"));
  autocomplete.addListener('places_changed', () => {
    console.log("Place to changed!");
    console.log(autocomplete);
    var places = autocomplete.getPlaces();
    if (places.length == 0) {
      console.log("No length");
    }
    var place = places[0];
    if (!place.geometry || !place.geometry.location) {
      console.log("Returned place contains no geometry");
      return;
    }
    console.log(place.geometry.location.toString());
  });
  autocomplete2.addListener('places_changed', () => {
    console.log("Place from changed!");
    console.log(autocomplete2);
    var places = autocomplete2.getPlaces();
    if (places.length == 0) {
      console.log("No length");
    }
    var place = places[0];
    if (!place.geometry || !place.geometry.location) {
      console.log("Returned place contains no geometry");
      return;
    }
    console.log(place.geometry.location.toString());
  });
}




const map = new google.maps.Map(document.getElementById("map"), {
center: new google.maps.LatLng(45.4215296, -75.6971931),
zoom: 15,
mapTypeId: google.maps.MapTypeId.ROADMAP,
});

const directionsService = new google.maps.DirectionsService();

directionsService.route(
{
        origin: "1111 Engineering Dr, Boulder, CO",
        destination: "1485 Delgany St, Denver, CO",
        travelMode: "DRIVING",
},
(response, status) => {
    if (status === "OK") {

        new google.maps.DirectionsRenderer({
            suppressMarkers: true,
            directions: response,
            map: map,
          });
    }
}
)
    </script>


  </main>




    <%- include ('../partials/footer') %>